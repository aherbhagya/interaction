[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2017-11-03 12:55:51.785127", 
  "name": "Customer-Client", 
  "script": "frappe.ui.form.on(\"Customer\", \"refresh\", function(frm, doctype, name) {\ncur_frm.add_custom_button(__('Add Interaction'), function() {\nvar d = frappe.prompt([\n    {'fieldname': 'person_interacted_with', 'fieldtype': 'Data', 'label': 'Person Interacted with', 'reqd': 0},    \n    {label:__(\"Type of Interaction\"), fieldtype:\"Select\",'default': \"Follow Up Call\",\n                    options: [\"Cold Call\",\"Follow Up Call\",\"Mail\",\"Cold Visit\",\"Follow Up Visit\",\"Existing Customer Visit\",\"SMS or Whatsapp\",\"Skype or Webex\"],\n                    fieldname:\"type_of_interaction\"},\n    {label:__(\"Result\"), fieldtype:\"Select\", options: \n    [\"Status Quo\",\"Warmer\",\"Colder\",\"Closed Lost\",\"Closed Won\"], fieldname:\"result\"},\n    {'fieldname': 'responsible', 'fieldtype': 'Link', options:\"User\", 'default': user, 'label': 'Responsible', 'reqd': 0},\n    {'fieldname': 'create_task', 'fieldtype': 'Check', 'default': true, 'label': 'Create Task'},\n    {fieldtype: \"Column Break\"},\n\n    {'fieldname': 'next_date', 'fieldtype': 'Date', \n    'label': 'Next Action Date', 'default': frappe.datetime.add_days(frappe.datetime.nowdate(),7), 'reqd': 0},\n    {'fieldname': 'next_action_by', 'fieldtype': 'Link', options:\"User\", 'default': user,'label': 'Next Action By', 'reqd': 0},\n    {'fieldname': 'comment', 'fieldtype': 'Text', 'label': 'Next Action Task', 'reqd': 1},\n    {fieldtype: \"Section Break\"},\n\n    {'fieldname': 'remarks', 'fieldtype': 'Text Editor', 'label': 'Remarks', 'reqd': 1} \n\n\n],\nfunction(values){\n    var c = d.get_values()\n    var cmnt = \"Person Interacted with: \"+ c.person_interacted_with\n               +\"<br>Type of Interaction: \"+ c.type_of_interaction\n               +\"<br>Result: \"+ c.result \n               +\"<br>Next Action Date: \" +c.next_date \n               +\"<br>Next Action By: \"+ c.next_action_by \n               + \"<br>Next Action Task: \"+c.comment \n               + \"<br>Responsible: \"+c.responsible \n               + \"<br>Remarks: \"+c.remarks\n\n                \n    var me = frm.doc\n    // start interaction master\n       frappe.call({\n            method: \"shopchemical.custom_methods.add_interaction\",\n            args: {\n                doc:{\n                    doctype: \"Interaction Master\",\n                    reference_doctype: frm.doc.doctype,\n                    reference_name: frm.doc.name,\n                    result: c.result,\n                    person_interacted_with: c.person_interacted_with,\n\n     //                responce_reson: c.responce_reson,\n                    next_action_date: c.next_date,\n                    type_of_interaction: c.type_of_interaction,\n                    // result: c.result,\n                    next_action_by: c.next_action_by,\n                    next_action_task: c.comment,\n                    remakrs: c.remarks,\n                    responsible: c.responsible\n                    // next_date\n                }\n            },\n            callback: function(r) {\n                        msgprint(\"Interaction master record created\");\n            }\n        });\n    //end interaction master\n//create todo\nconsole.log(c.create_task);\n    if(c.create_task==true){\n        frappe.call({\n                        method: \"shopchemical.custom_methods.create_todo\",\n                        args: {\n                            owner: c.next_action_by,\n                            assigned_by: c.responsible,\n                            description: c.comment,\n                            date: c.next_date,\n                            reference_name: frm.doc.name,\n                            reference_type: frm.doc.doctype\n                        }\n                    })\n    }\n//end of create todo\n\n    return frappe.call({\n            method: \"frappe.desk.form.utils.add_comment\",\n            args: {\n                doc:{\n                    doctype: \"Communication\",\n                    communication_type: \"Comment\",\n                    reference_doctype: frm.doc.doctype,\n                    reference_name: frm.doc.name,\n                    comment: \"cmnt\",\n                    subject: \"cmnt\",\n                    content: cmnt,\n                    responce_reson: c.responce_reson,\n                    next_date: c.next_date,\n                    type_of_interaction: c.type_of_interaction,\n                    result: c.result,\n                    next_action_by: c.next_action_by,\n                    reference_owner: frm.doc.owner,\n                    comment_by: user,\n                    user: user,\n                    sender_full_name:user_fullname,\n                }\n            },\n            callback: function(r) {\n                        msgprint(\"Interaction Submited Successfully\");\n                        cur_frm.reload_doc();\n            if (cur_frm) {\n                        if (cur_frm.docname && (frappe.last_edited_communication[cur_frm.doctype] || {})[cur_frm.docname]) {\n                            delete frappe.last_edited_communication[cur_frm.doctype][cur_frm.docname];\n                        }\n                    }\n            }\n        });\n},\n'Add Interaction',\n'Submit','Add Interaction', \"btn-default\"\n)\n});\n\n                        // frm.refresh();\n\n});", 
  "script_type": "Client"
 }
]